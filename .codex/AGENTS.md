# AGENTS ガイドライン（Video Coach / Laravel 12）\n\n## 基本スタンス\n- すべて日本語で簡潔に回答する。\n- 既存の構造・命名・依存関係を崩さない。新しい基盤ディレクトリや依存追加は事前検討必須。\n- 必要なドキュメントのみ作成（ユーザー依頼がある場合に限る）。\n\n## スタック概要（遵守バージョン）\n- PHP 8.5 / Laravel 12 / Fortify / Livewire v3 / Volt v1 / Flux UI Free v2 / Tailwind CSS v4 / Vite 7 / Pest v4 / PHPUnit 12 / Pint / Sail。\n\n## コーディング規約\n- コントロール構造は必ず波括弧。型宣言を明示（引数・戻り値）。\n- FormRequest でバリデーションを行い、コントローラに直接書かない。\n- Eloquent リレーションを優先し、N+1 を避ける（必要なら eager load）。\n- env() は config 以外で使わない。ルート生成は named route を使用。\n- テストは変更に影響する最小範囲を実行（原則 `php artisan test`）。\n\n## フロントエンド\n- Editor の video/canvas は JS 主導（`wire:ignore`）。動画ピクセル座標で保存し、描画・ヒットテスト・ハンドルで同一 mapper を使用。\n- Tailwind v4 前提。既存クラス順序・パターンを踏襲し、不要な冗長クラスを避ける。\n- Vite でビルド。反映されない場合は `npm run build` or `npm run dev` を案内。\n\n## テスト・品質\n- 変更後は関連テスト＋必要なら全体 `php artisan test`。フロントのみの変更でも可能なら関連ユニット/フィーチャテストを追加。\n- フォーマット: `vendor/bin/pint --dirty` を推奨。\n\n## Kinovea に関する重要制約（GPL v2 注意）\n- `third_party/kinovea/` は参照専用。ソースコードのコピー/翻訳/移植は禁止。\n- 許可される利用: 挙動の理解、KVA 生成によるフィクスチャ作成、ドキュメント参照。クリーンルームで再実装すること。\n- Kinovea から得た知見は出典ファイルパスをメモに残し、コードには流用しない。\n\n## 仕様ソース\n- `.codex/docs/drawing-engine.md`：座標変換・描画/ヒットテスト原則（必読）。\n- `.codex/docs/kva-mapping.md`：KVA とのマッピング方針。\n- `.sdd/specs/*`：ステアリング/要件/設計/タスク。実装前に該当 spec を確認。\n\n## Boost / MCP ツール利用\n- ドキュメント検索は `search-docs`（Laravel/Livewire/Tailwind/Pestなど）を最優先で使う。\n- Artisan 実行前は `list-artisan-commands` でオプション確認。\n- DB 読取は `database-query`、PHP 実行は `tinker`、ブラウザログは `browser-logs` を活用。\n\n## デプロイ・CI 目安\n- コンテナ: PHP-FPM + Nginx シンプル構成。\n- ビルド: `composer install --no-dev`, `npm ci && npm run build`, `php artisan test` を CI で実行。\n\n## プロジェクト要約\n- 動画コーチング用エディタ。注釈・角度・矢印・キーフレームを `analysis_json`（`videocoach.analysis@1.0.0`）に保存。\n- API: GET/PUT `/api/projects/{project}/analysis` が唯一のソースオブトゥルース。\n- 座標は動画ピクセル系のみ（Canvas/CSS 座標保存は禁止）。\n\n## 変更前チェックリスト\n- 対応する spec/task を確認したか？\n- Kinovea GPL コードを流用していないか？\n- 既存コンポーネント・パターンを再利用しているか？\n- 必要なテストを追加/更新し実行したか？\n- ユーザーへの案内は簡潔な日本語になっているか？\n*** End Patch
