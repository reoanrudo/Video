# 要件ドラフト（MVP / リリース 2025-12-20）

## ビジョン / 成功基準（暫定）
- 目的: コーチング向けに「動画上へ描画・計測・キーイメージを重ねて保存・再現」できる Web エディタを提供する。
- 成功指標: 利用頻度や注釈数は未定。KPI は要確認（例: 週次アクティブプロジェクト数、保存成功率、平均セッション長）。

## 主要ステークホルダー
- 利用者: コーチ/トレーナーなど認証済みユーザー（Fortify 認証）。
- 運用: デプロイ/インフラは本タスク側で設計・実装方針を決定する想定。

## ユースケース（代表）
1) ユーザーはログイン後、ダッシュボードでプロジェクトを作成し、動画をアップロードする。
2) エディタで描画ツールを用いて注釈（線/矢印/角度/ペン/マーカー/テキスト等）を追加し、キーイメージを手動・自動で生成する。
3) 保存すると `analysis_json` に全注釈とキーイメージが動画ピクセル座標で永続化される。再読み込みで完全再現される。

## 機能要件（MVP）
- 認証/認可: Fortify ログイン必須。プロジェクトはユーザー単位で隔離。
- プロジェクト管理: 作成・一覧・エディタ遷移。削除/共有は未定（今回はスコープ外）。
- 動画再生: 再生/一時停止、シークバー、速度変更、フレーム送り（簡易）。
- 描画ツール（`.codex/docs/editor-scope.md` / `editor-interactions.md` 準拠）:
  - 移動/選択、キーイメージ追加、コメント、テキスト、ペン、ライン、矢印（通常/破線以上は Phase2）、クロスマーカー、角度（3点）、ストップウォッチ、トラック簡易、図形（円相当）、テンプレ/スタンプ最小限。
  - ヒットテスト・ハンドル操作は動画ピクセル座標を共通 mapper で変換。
  - Undo/Redo、Delete、スタイル編集（色/線幅/不透明度/一部 dash・曲線・squiggle パラメータ）。
- キーイメージ: 手動追加 + 注釈確定時の自動追加（±0.3s 近傍重複抑止）。サムネクリックでジャンプ。
- 保存/復元: GET `/api/projects/{project}/analysis` / PUT `/api/projects/{project}/analysis` で `analysis_json` を取得・保存。スキーマ `videocoach.analysis@1.0.0` を厳格に検証。
- 描画エンジン: 動画ピクセル座標のみを永続化し、描画/ヒットテスト/ハンドルに同一変換を使用。deterministic redraw。DPR 対応。
- エラー/バリデーション: SaveAnalysisRequest でスキーマ検証。権限は user-owner を確認。

## 非機能要件（暫定）
- 期限: 2025-12-20（土）初期リリース。
- ブラウザ: デスクトップ Evergreen（Chrome/Edge/Firefox/Safari 最新）をサポート。モバイルは後続検討。
- 性能: 通常の 1080p 短尺クリップで滑らかに再生・描画できること（目安: 再描画は rAF 1 フレーム内完了、保存は 1 秒以内）。
- 信頼性: 保存 API は 200 応答で永続化完了を保証。失敗時はユーザーに通知。
- アクセシビリティ: キーボードショートカット（Undo/Redo/Delete/Space 再生）を提供。

## データ/スキーマ
- `projects` テーブル: `analysis_schema_version`（デフォルト `videocoach.analysis@1.0.0`）、`analysis_json`（JSON cast）。
- 描画/キーイメージのデータモデルは `.codex/docs/drawing-engine.md` / `.codex/docs/editor-interactions.md` に準拠。
- KVA 互換: `.codex/docs/kva-mapping.md` の範囲で将来拡張。MVPは最小マッピングのみ。

## デプロイ/インフラ（案）
- アプリ: PHP 8.2 / Laravel 12 をコンテナ化。
- DB: SQLite → 本番は Postgres/MySQL へ移行を検討（要決定）。
- ストレージ: 動画アップロード先はオブジェクトストレージ（S3 互換）を推奨。容量上限・リージョンは未決定。
- CI/CD: GitHub Actions 等でテスト + ビルド → コンテナレジストリ → 本番環境へデプロイ（詳細は次フェーズで決定）。

## 受け入れ基準（初版）
- 採用ツールで作成→選択/移動/削除→Undo/Redo→保存→リロードで完全再現。
- キーイメージの手動/自動追加、重複抑止、ジャンプが動作。
- `php artisan test` 緑。フロント変更があれば `npm run build` が成功。
- 認可: 他ユーザーのプロジェクトにアクセスすると 403。
- スキーマ不正時はバリデーションエラーで保存されない。

## オープン事項（要決定）
- KPI 数値（アクティブユーザー/保存成功率など）。
- 動画保存先・容量上限・保存期間。
- 共有/エクスポート要件（画像キャプチャ、動画書き出し、外部共有リンク）。
- モバイル/タブレット対応要否と優先度。
- 本番 DB/ストレージ・デプロイ先の確定。

