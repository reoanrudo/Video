# タスク分解（MVP リリース 2025-12-20）\n\n## 0. 環境・インフラ\n- [ ] デプロイ先決定（例: ECS/Fargate or Render/Heroku など）。\n- [ ] DB 選定と接続設定（本番は Postgres/MySQL 推奨）。\n- [ ] ストレージ選定（S3 互換）と環境変数定義（バケット名/リージョン/ACL）。\n- [ ] CI/CD パイプライン雛形（GitHub Actions で phpunit + vite build + コンテナ build/push）。\n\n## 1. フロントエンド（Editor 機能）\n- [ ] ツールモデルの再整理（13ツールのスイッチ・ハンドル定義を `store/hittest` に明文化）。\n- [ ] 矢印・角度バリアントの整理（既存バリアント vs MVP 必須の通常/破線/3点角）。\n- [ ] キーイメージ自動追加（注釈確定時 ±0.3s 近傍重複抑止）。\n- [ ] Undo/Redo 履歴の確定イベント整理（ドラッグ終了で push、バッチ適用）。\n- [ ] ステータス/トースト表示（保存成功/失敗、バリデーションエラー）。\n- [ ] パフォーマンス確認（1080p 動画で描画遅延が無いか）。\n\n## 2. バックエンド/API\n- [ ] `SaveAnalysisRequest` を必要に応じて拡張（追加フィールド shape 定義、array shape の厳格化）。\n- [ ] API エラーハンドリング統一（422/403/500 の返し方とメッセージ）。\n- [ ] KVA passthrough の維持確認（extensions.kvaPassthrough を壊さない）。\n\n## 3. データ/移行\n- [ ] 本番 DB 用マイグレーション/環境変数整備。\n- [ ] 動画ストレージ導線（S3 disk 設定、署名付き URL か直アップロード方式を選定）。\n- [ ] 大容量アップロード方針（必要なら chunked / multipart）。\n\n## 4. QA / 受け入れテスト\n- [ ] シナリオテスト: 13ツールの「追加→編集→削除→Undo/Redo→保存→再読み込み再現」。\n- [ ] キーイメージ: 手動/自動/重複抑止/ジャンプ。\n- [ ] 権限: 他ユーザーアクセスで 403 を確認。\n- [ ] バリデーション: スキーマ不正時に 422 で保存されないこと。\n- [ ] 回帰: docs/BUG_DRAWING.md の再現シナリオで初期描画が見えること。\n\n## 5. ドキュメント/運用\n- [ ] `.env.example` にデプロイ/ストレージ/DB 必須キーを追記。\n- [ ] README or ops ドキュメントにデプロイ手順/CI 設定を記載（必要最小限）。\n\n## オープン事項（要決定）\n- KPI 数値、動画容量上限、共有/エクスポート要件、モバイル対応要否、具体的なデプロイ先。\n*** End Patch
